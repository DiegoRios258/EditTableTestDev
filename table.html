<!DOCTYPE html>
<html>
<head>
	<title></title>
	<script type="text/javascript"  src="js/vue.js"></script>
	<link rel="stylesheet" href="css/bootstrap.min.css">
	<link rel="stylesheet" href="css/main.css">
</head>
<body>
  <div class="row" id="tblMain">

     <div class="row">
     	   <div class="cal-sm-12">
     	 	  <center> <h3>{{Nombre}}</h3> </center>
     	   </div>
     </div>

		 <hr>

     <div class="row">
        <div class="col-sm-2"> </div>

        <div class="col-sm-8">
          <div class="table-responsive">
						 <showup-table :data="UserRegister" :columns="Columns"></showup-table>
		      </div>
	      </div>

	    	<div class="col-sm-2">  </div>
     </div>

		 <hr>
     <!-- <pre class="text-center">
      {{ UserRegister }}
     </pre> -->

  </div>

	<template id="TableMain">
		<div class="">
			<div class="">
					<table class="table table-bordered table-hover table-striped showup-table">
				 		<thead>
				 				<tr>
				 					 <th v-for="column in columns"
									     :id="'col_'+column.value"
											 :class="{ sorter: sortKey == column.value }"
											  @click="sortBy(column.value,column.Type)">
				 					  	{{ column.value }}
											<span class="arrow" :class="sortOrders[column.value] > 0 ? 'asc' : 'dsc'"> </span>
				 					 </th>
				 				</tr>
				 		 </thead>
						 <thead>
						 	<tr>
						 		 <th v-for="column in columns">
									  <showup-search :row="column"> </showup-search>
								 </th>
						 	</tr>
						 </thead>
						 <tbody>
						 	 <tr v-for="data in filteredData">
			            <td v-for="(key , index) in columns" :id="'row_'+index" :class="'app-'+(key.short ? 'row' : 'active')">
			                <span v-show="data[key.value].span" @click="Edit(data[key.value])">
											  {{ data[key.value].value }}
										  </span>
										  <showup-textbox :content="data" :row="key"></showup-textbox>
									</td>
						 	 </tr>
						 </tbody>
			 	  </table>
				</div>
				<div class="">
					<div class="text-right showup-footer">
						<nav aria-label="Page navigation">
						 <ul class="pagination">
							   <li v-for="page in TotalGrid">
									 <a href="javascript:void(0)"  @click="setPage(page)">{{page}}</a>
								 </li>
						 </ul>
					 </nav>
					</div>
				</div>
		</div>
	</template>

	<template id="txtMain">
		  <input type="text"
			       v-show="content[row.value].txt"
			       :value="content[row.value].value"
						 @mouseleave="leave(content[row.value], row, $event)"
						 @keyup="NewData(content[row.value], row, $event)"
						 class="form-control"
						 style="width:106%; margin: -8px;">
	</template>

	<template id="txtSearch">
		 <input type="text"
		        class="form-control"
						style="width:100%; height:25px; font-size: 10px;"
						v-show="row.filter"
						:placeholder="row.value">
	</template>

	<script  type="text/javascript">

	    Vue.component("showup-search",{
        template : '#txtSearch',
				props:{
					row: Object
				}
		  });

	    Vue.component("showup-table",{

				  template: "#TableMain",
					props:
					{
						 data: Array,
						 columns: Array
					},
					data: function ()
					{
					 var sortOrders = {}
					 this.columns.forEach(function (key) {
						 sortOrders[key.value] = 1
					 })
					 return {
						 sortKey: '',
						 type: '',
						 currentPage: 0,
						 itemsPerPage: 2,
						 totalD: 0,
						 sortOrders: sortOrders
					 }
				 },
				 computed:
				 {
				    filteredData: function ()
						{
							// Sorter
				      var sortKey = this.sortKey
				      var order = this.sortOrders[sortKey] || 1
				      var data = this.data
							var type = this.type
							this.totalD = data.length;

							if (sortKey)
							{
								data = data.slice().sort(function (a, b) {
									a = type == "Number" ? parseInt(a[sortKey].value) : a[sortKey].value
									b = type == "Number" ? parseInt(b[sortKey].value) : b[sortKey].value
									return (a === b ? 0 : a > b ? 1 : -1) * order
								});
							}

							if (this.currentPage >= this.totalPages())
							{
				        this.currentPage = Math.max(0, this.totalPages() - 1);
				      }
							var index = this.currentPage * this.itemsPerPage;

							data = data.slice(index, index + this.itemsPerPage);

							return data
				    },
						TotalGrid: function(){
							return this.totalPages()
						}
				 },
				 methods:
				 {
					 totalPages: function()
					 {
						 console.log(Math.ceil(this.totalD / this.itemsPerPage) + " totalPages");
			       return Math.ceil(this.totalD / this.itemsPerPage);
					 },
					 setPage: function(pageNumber) {
			       this.currentPage = pageNumber;
			       console.log(pageNumber);
			     },
					 sortBy: function (key, type)
					 {
				    this.sortKey = key
						this.type = type
				    this.sortOrders[key] = this.sortOrders[key] * -1
				   },
					 Edit: function(dato)
					 {
						 dato.txt  = (dato.txt ? false : true);
						 dato.span = (dato.span ? false : true);
					 }
				 }
		  });

	    Vue.component("showup-textbox" ,{
				 template : '#txtMain',
	     	 props: {
						 content: Object,
						 row: Object
					},
					methods:
					{
						leave: function(dato, field , _evt)
						{
							var oldNit = dato.value;
							if( _evt.path[0].value.trim()  )
							{
								 dato.value = this.TypeValidation(field.Type, _evt.path[0].value) ? _evt.path[0].value : oldNit;
							}
							else
							{
								 dato.value = oldNit;
							}
							dato.txt  = (dato.txt ? false : true);
							dato.span = (dato.span ? false : true);
						},
						NewData: function(dato , field ,_evt)
						{
							//console.log(field);
							if( !this.TypeValidation( field.Type , _evt.path[0].value ) )
							{
								alert("Solo se permiten n√∫meros");
							}
						},
						TypeValidation: function(type , dato)
						{
								 if( type == "Number" )
								 {
										 return isNaN( dato ) ? false : true;
								 }
								 else if( type == "String" )
								 {
										return typeof dato == "string" ? true : false;
								 }
						}
					}
      });

		  var Showup = new Vue({

            el: '#tblMain',

            data :
						{
                Nombre: "Edit Table Vue App",

                Columns: [
			            {value: "CustNum", short: true, Type: "Number",filter : true},
								  {value: "Nit", short: false, Type: "Number",filter : true},
									{value: "Nombre", short: false, Type: "String",filter : true},
								  {value: "Apellido", short: false , Type: "String",filter : true}
								],

            	  UserRegister: [
                  {
                    CustNum: {value : 1, span : true} ,
                  	Nit: { value: 1035415, txt: false, span: true } ,
                  	Nombre: { value: "Diego", txt: false, span: true } ,
                  	Apellido: { value: "Rojas", txt: false, span: true }
                  },
                  {
                  	CustNum: {value: 2, span: true} ,
                  	Nit: { value: 8888888, txt: false, span: true } ,
                  	Nombre: { value: "Manolo", txt: false, span: true },
                  	Apellido: { value: "Rios", txt: false, span: true }
                  },
                  {
                  	CustNum: {value: 3, span: true} ,
                  	Nit: { value: 9999999, txt: false, span: true } ,
                  	Nombre: { value: "Tori", txt: false, span: true } ,
                  	Apellido: { value: "Rios", txt: false, span: true }
                  }
            	  ]
            }
		 });
	</script>
</body>
</html>
